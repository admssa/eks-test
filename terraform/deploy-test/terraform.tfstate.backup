{
  "version": 4,
  "terraform_version": "0.12.25",
  "serial": 7,
  "lineage": "9f68eed5-d6d5-741c-039f-e0e2c6113038",
  "outputs": {},
  "resources": [
    {
      "module": "module.test_s3_rw",
      "mode": "data",
      "type": "aws_caller_identity",
      "name": "current",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "account_id": "567320100185",
            "arn": "arn:aws:iam::567320100185:user/sergii.shapovalenko",
            "id": "2020-09-30 16:50:53.405892 +0000 UTC",
            "user_id": "AIDAYIFXJXVM2NJHTU6DC"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_eks_cluster_auth",
      "name": "eks",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "2020-09-30 16:50:52.933121 +0000 UTC",
            "name": "test",
            "token": "k8s-aws-v1.aHR0cHM6Ly9zdHMuYW1hem9uYXdzLmNvbS8_QWN0aW9uPUdldENhbGxlcklkZW50aXR5JlZlcnNpb249MjAxMS0wNi0xNSZYLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFZSUZYSlhWTTNMVFZWQU1HJTJGMjAyMDA5MzAlMkZ1cy1lYXN0LTElMkZzdHMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDIwMDkzMFQxNjUwNTJaJlgtQW16LUV4cGlyZXM9MCZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QlM0J4LWs4cy1hd3MtaWQmWC1BbXotU2lnbmF0dXJlPTNhYmZlZDdmM2VhMGQ4MDE5Njc4NTVhM2E4NTcyYmVlMDI5M2E4YmZkM2FkZTMxN2FlZTFhMWM3YWYwMjRiM2Y"
          }
        }
      ]
    },
    {
      "module": "module.test_s3_rw",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "main",
      "each": "list",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "id": "3000721203",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"Global\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListAllMyBuckets\",\n        \"s3:GetBucketLocation\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"BucketRWAccess\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListBucketMultipartUploads\",\n        \"s3:ListBucket\",\n        \"s3:GetBucketWebsite\",\n        \"s3:GetBucketLocation\"\n      ],\n      \"Resource\": \"arn:aws:s3:::admssa.test\"\n    },\n    {\n      \"Sid\": \"ObjectRWAccess\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:PutObject\",\n        \"s3:ListObjectsV2\",\n        \"s3:ListMultipartUploadParts\",\n        \"s3:GetObjectTorrent\",\n        \"s3:GetObject\",\n        \"s3:DeleteObject\",\n        \"s3:AbortMultipartUpload\"\n      ],\n      \"Resource\": \"arn:aws:s3:::admssa.test/*\"\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "s3:GetBucketLocation",
                  "s3:ListAllMyBuckets"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": "Global"
              },
              {
                "actions": [
                  "s3:GetBucketLocation",
                  "s3:GetBucketWebsite",
                  "s3:ListBucket",
                  "s3:ListBucketMultipartUploads"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:s3:::admssa.test"
                ],
                "sid": "BucketRWAccess"
              },
              {
                "actions": [
                  "s3:AbortMultipartUpload",
                  "s3:DeleteObject",
                  "s3:GetObject",
                  "s3:GetObjectTorrent",
                  "s3:ListMultipartUploadParts",
                  "s3:ListObjectsV2",
                  "s3:PutObject"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:s3:::admssa.test/*"
                ],
                "sid": "ObjectRWAccess"
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "module": "module.sa_role_test",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "sa_assume_role_policy",
      "each": "list",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "id": "2832808585",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::567320100185:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/A5A32BA2294771E05D92BA67C968B55F\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.eu-west-1.amazonaws.com/id/A5A32BA2294771E05D92BA67C968B55F:sub\": \"system:serviceaccount:default:test\"\n        }\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRoleWithWebIdentity"
                ],
                "condition": [
                  {
                    "test": "StringEquals",
                    "values": [
                      "system:serviceaccount:default:test"
                    ],
                    "variable": "oidc.eks.eu-west-1.amazonaws.com/id/A5A32BA2294771E05D92BA67C968B55F:sub"
                  }
                ],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "arn:aws:iam::567320100185:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/A5A32BA2294771E05D92BA67C968B55F"
                    ],
                    "type": "Federated"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "module": "module.test_s3_rw",
      "mode": "data",
      "type": "null_data_source",
      "name": "buckets",
      "each": "list",
      "provider": "provider.null",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "has_computed_default": "default",
            "id": "static",
            "inputs": {
              "bucket_arn": "arn:aws:s3:::admssa.test",
              "bucket_name": "admssa.test"
            },
            "outputs": {
              "bucket_arn": "arn:aws:s3:::admssa.test",
              "bucket_name": "admssa.test"
            },
            "random": "7228055860146821887"
          }
        }
      ]
    },
    {
      "module": "module.test_s3_rw",
      "mode": "data",
      "type": "null_data_source",
      "name": "objects",
      "each": "list",
      "provider": "provider.null",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "has_computed_default": "default",
            "id": "static",
            "inputs": {
              "object_arn": "arn:aws:s3:::admssa.test/*",
              "object_name": "admssa.test/*"
            },
            "outputs": {
              "object_arn": "arn:aws:s3:::admssa.test/*",
              "object_name": "admssa.test/*"
            },
            "random": "3017167448589110153"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "terraform_remote_state",
      "name": "eks",
      "provider": "provider.terraform",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "backend": "local",
            "config": {
              "value": {
                "path": "./../eks-test/terraform.tfstate"
              },
              "type": [
                "object",
                {
                  "path": "string"
                }
              ]
            },
            "defaults": null,
            "outputs": {
              "value": {
                "cluster_ca": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01Ea3pNREUxTVRnME1Wb1hEVE13TURreU9ERTFNVGcwTVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBS2lJClpoWGRMUEUzUXFGam5JMFBKMWxLeXdTK3h5eG1mMlpHZ3RieCtqQW1aSXpsalhDc00wLyswMGh3VHZFZHJ1T2IKaGFYTHhKSG9TSFlObWlZdXFxYm96RXhBVTBtQ0xnUGpkbEkwK1A4eEZ6TE41eENyZDBVeTJBYjFoRFR1SEh6eAo4QkxiMzJFbUErNTQrMys4alVwWXphQVhucTVnWVcyUDlTa3h4VXI5eGVxbzBuK2liTlpYSjZiYUo2SW12WFpyCjU0WENaWGFjU1VWRXFIczJQQ3ZjdjB3a1lZajBtcXMvSUt0U0ZCNGl2MmtablU1Z3FTVlNpZFQvT21kbzZFb2wKZG1LOEpUa1dVcEhxY0U0cHR0VlFwU3NlQkZnWWZBU1pkVXJDK0thNEFiNXIyWUI4VG0rZVJIdlBtNnVZSmJtegpTMFpUS3lWdzlCSXVwSFBvWWg4Q0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFEUFB2cXBKZUNVR3lLaFNDcURqZHBQT04zMVIKNFpOb0U5SjYySnhJcXE5Ky9kODVKWVBoSmN0M0U0S1pxa2tvcCtCOW9DaHEwaWdRcEp2bEtVSVIyMWJwUzRUMQppOGQxaThvdXZCdWxSMnYxcU9Xc0QvVDkvSUdDUFc3NG8rNFN6WVZuRVNjWUZwaGVHWE1KdHRwby9UL2xBb2NvCkd6WFNMZWR5MlB1VXpvTFQrQytnelVNVk5PdW8wa3g0L1pYNG5ZL2UrN1pXWDJCK216clJWTWZEL203NlZ5eGUKbHFkM1hienZENThFcUtPdGlWV1pTSXVYRE9nZmFXZXhSTnRHMGRXRnp0UzB3SFl2SzlUNXhxUFM0djAwWG4rTQpsT0J2ZkRORGZzdSs4N3o4UmMzUCt3YkJxTHJXTXg1c25jTnRtMGZXZGc5U0ZoYkNOQldwRCttc3dmTT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
                "cluster_ednpoint": "https://A5A32BA2294771E05D92BA67C968B55F.gr7.eu-west-1.eks.amazonaws.com",
                "cluster_name": "test",
                "kubeconfig": "apiVersion: v1\nclusters:\n- cluster:\n    server: \"https://A5A32BA2294771E05D92BA67C968B55F.gr7.eu-west-1.eks.amazonaws.com\"\n    certificate-authority-data: \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01Ea3pNREUxTVRnME1Wb1hEVE13TURreU9ERTFNVGcwTVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBS2lJClpoWGRMUEUzUXFGam5JMFBKMWxLeXdTK3h5eG1mMlpHZ3RieCtqQW1aSXpsalhDc00wLyswMGh3VHZFZHJ1T2IKaGFYTHhKSG9TSFlObWlZdXFxYm96RXhBVTBtQ0xnUGpkbEkwK1A4eEZ6TE41eENyZDBVeTJBYjFoRFR1SEh6eAo4QkxiMzJFbUErNTQrMys4alVwWXphQVhucTVnWVcyUDlTa3h4VXI5eGVxbzBuK2liTlpYSjZiYUo2SW12WFpyCjU0WENaWGFjU1VWRXFIczJQQ3ZjdjB3a1lZajBtcXMvSUt0U0ZCNGl2MmtablU1Z3FTVlNpZFQvT21kbzZFb2wKZG1LOEpUa1dVcEhxY0U0cHR0VlFwU3NlQkZnWWZBU1pkVXJDK0thNEFiNXIyWUI4VG0rZVJIdlBtNnVZSmJtegpTMFpUS3lWdzlCSXVwSFBvWWg4Q0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFEUFB2cXBKZUNVR3lLaFNDcURqZHBQT04zMVIKNFpOb0U5SjYySnhJcXE5Ky9kODVKWVBoSmN0M0U0S1pxa2tvcCtCOW9DaHEwaWdRcEp2bEtVSVIyMWJwUzRUMQppOGQxaThvdXZCdWxSMnYxcU9Xc0QvVDkvSUdDUFc3NG8rNFN6WVZuRVNjWUZwaGVHWE1KdHRwby9UL2xBb2NvCkd6WFNMZWR5MlB1VXpvTFQrQytnelVNVk5PdW8wa3g0L1pYNG5ZL2UrN1pXWDJCK216clJWTWZEL203NlZ5eGUKbHFkM1hienZENThFcUtPdGlWV1pTSXVYRE9nZmFXZXhSTnRHMGRXRnp0UzB3SFl2SzlUNXhxUFM0djAwWG4rTQpsT0J2ZkRORGZzdSs4N3o4UmMzUCt3YkJxTHJXTXg1c25jTnRtMGZXZGc5U0ZoYkNOQldwRCttc3dmTT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\"\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    user: aws\n  name: aws\ncurrent-context: aws\nkind: Config\npreferences: {}\nusers:\n- name: aws\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1alpha1\n      command: aws-iam-authenticator\n      args:\n        - \"token\"\n        - \"-i\"\n        - \"test\"\n",
                "oidc_arn": "arn:aws:iam::567320100185:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/A5A32BA2294771E05D92BA67C968B55F",
                "oidc_url": "oidc.eks.eu-west-1.amazonaws.com/id/A5A32BA2294771E05D92BA67C968B55F"
              },
              "type": [
                "object",
                {
                  "cluster_ca": "string",
                  "cluster_ednpoint": "string",
                  "cluster_name": "string",
                  "kubeconfig": "string",
                  "oidc_arn": "string",
                  "oidc_url": "string"
                }
              ]
            },
            "workspace": "default"
          }
        }
      ]
    },
    {
      "module": "module.test_s3_rw",
      "mode": "managed",
      "type": "aws_iam_group_policy",
      "name": "group_policy",
      "each": "list",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "module": "module.test_s3_rw",
      "mode": "managed",
      "type": "aws_iam_policy",
      "name": "managed_policy",
      "each": "list",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "module": "module.sa_role_test",
      "mode": "managed",
      "type": "aws_iam_policy",
      "name": "sa_policy",
      "each": "list",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "module": "module.sa_role_test",
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "sa_assume_role",
      "each": "list",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::567320100185:role/test/default/eks-test-default-test",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Federated\":\"arn:aws:iam::567320100185:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/A5A32BA2294771E05D92BA67C968B55F\"},\"Action\":\"sts:AssumeRoleWithWebIdentity\",\"Condition\":{\"StringEquals\":{\"oidc.eks.eu-west-1.amazonaws.com/id/A5A32BA2294771E05D92BA67C968B55F:sub\":\"system:serviceaccount:default:test\"}}}]}",
            "create_date": "2020-09-30T16:41:33Z",
            "description": "",
            "force_detach_policies": false,
            "id": "eks-test-default-test",
            "max_session_duration": 3600,
            "name": "eks-test-default-test",
            "name_prefix": null,
            "path": "/test/default/",
            "permissions_boundary": null,
            "tags": {},
            "unique_id": "AROAYIFXJXVMXTWGB6CXP"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "module": "module.test_s3_rw",
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "s3_role_policy",
      "each": "list",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "id": "eks-test-default-test:s3-rw-access",
            "name": "s3-rw-access",
            "name_prefix": null,
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"Global\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListAllMyBuckets\",\n        \"s3:GetBucketLocation\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"BucketRWAccess\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListBucketMultipartUploads\",\n        \"s3:ListBucket\",\n        \"s3:GetBucketWebsite\",\n        \"s3:GetBucketLocation\"\n      ],\n      \"Resource\": \"arn:aws:s3:::admssa.test\"\n    },\n    {\n      \"Sid\": \"ObjectRWAccess\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:PutObject\",\n        \"s3:ListObjectsV2\",\n        \"s3:ListMultipartUploadParts\",\n        \"s3:GetObjectTorrent\",\n        \"s3:GetObject\",\n        \"s3:DeleteObject\",\n        \"s3:AbortMultipartUpload\"\n      ],\n      \"Resource\": \"arn:aws:s3:::admssa.test/*\"\n    }\n  ]\n}",
            "role": "eks-test-default-test"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "module.sa_role_test.aws_iam_role.sa_assume_role"
          ]
        }
      ]
    },
    {
      "module": "module.sa_role_test",
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "policy_arns",
      "each": "list",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "module": "module.sa_role_test",
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "sa_role_attachment",
      "each": "list",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "module": "module.test_s3_rw",
      "mode": "managed",
      "type": "aws_iam_user_policy",
      "name": "s3_user_policy",
      "each": "list",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "module": "module.deployment",
      "mode": "managed",
      "type": "kubernetes_deployment",
      "name": "this",
      "provider": "provider.kubernetes",
      "instances": []
    },
    {
      "module": "module.deployment",
      "mode": "managed",
      "type": "kubernetes_service_account",
      "name": "this",
      "provider": "provider.kubernetes",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "automount_service_account_token": true,
            "default_secret_name": "test-token-gp7rf",
            "id": "default/test",
            "image_pull_secret": [],
            "metadata": [
              {
                "annotations": {
                  "eks.amazonaws.com/role-arn": "arn:aws:iam::567320100185:role/test/default/eks-test-default-test"
                },
                "generate_name": "",
                "generation": 0,
                "labels": null,
                "name": "test",
                "namespace": "default",
                "resource_version": "16394",
                "self_link": "/api/v1/namespaces/default/serviceaccounts/test",
                "uid": "527f3635-a577-459f-9b87-932aada29e82"
              }
            ],
            "secret": [],
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMH19",
          "dependencies": [
            "module.sa_role_test.aws_iam_role.sa_assume_role"
          ]
        }
      ]
    }
  ]
}
